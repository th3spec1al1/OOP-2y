# Лабораторная 5

# Отрабатываемый материал

Многослойные архитектуры, паттерны

# Цель

Проверить освоение студентом многослойных архитектур

# Задание

Реализовать систему банкомата

# Функциональные требования

- создание сессии
- создание счета
- просмотр баланса счета
- снятие денег со счета
- пополнение счета
- просмотр истории операций

Любые операции со счётом должны приводить к созданию истории операций.

# Не функциональные требования

- приложение должно иметь гексагональную архитектуру
    - Связывание абстракций и реализаций должно быть реализовано через Microsoft.Extensions.DependencyInjection (MSDI)
    - Каждый модуль должен описывать методы расширения, инкапсулирующие регистрацию всех реализаций модуля
    - опционально: можно реализовать луковую архитектуру с богатой доменной моделью.
    - необходимо самостоятельно спроектировать структуру проектов в соответсвующей solution-папке
- Web API интерфейс
    - Для реализации Web API должен использоваться фреймворк ASP.NET
    - Для реализации Web API должны использоваться контроллеры, использование Minmal API запрещено
- возможность создания сессий
    - пользовательская
        - должны быть запрошены данные счёта (номер, пин-код)
        - при создании пользовательской сессии должна сохраняться информация, необходимая для выполнения операций над
          счётом пользователя
    - админская
        - должен быть запрошен системный пароль
    - создание сессии должно возвращать ключ сессии (можно использовать `Guid`)
    - дальнейшие операции системы должны принимать на вход ключ сессии и делать соответсвующую авторизацию
    - сессии и их данные дожны быть сохранены при помощи репозиториев
- системный пароль должен быть параметризуем
- при попытке выполнения некорректных операций, должен возвращаться соответсвующий HTTP код (BadRequest/Unauthorized)
- реализация сохранения данных должна быть реализована как in-memory репозитории, код приложения не должен завязываться
  на то, что данные хранятся в памяти

# Упрощения

- ASP.NET используется только для упрощения реализации слоя представления
- В данной лабораторной от вас не требуется идиоматичная реализация Web API
    - не требуется соблюдение REST при именовании эндпоинтов
    - не требуется реализовывать документацию для эндпоинтов
    - не требуется использовать корректные HTTP коды (за исключением базовых ошибок, описанных выше)

# Test cases

- снятие денег со счёта
    - при достаточном балансе проверить что сохраняется счёт с корректно обновлённым балансом
    - при недостаточном балансе сервис должен вернуть ошибку
- пополнение счёта
    - проверить что сохраняется счёт с корректно обновлённым балансом

Данные тесты должны проверять бизнес логику, они не должны как-либо зависеть от логики хранения данных или Web
представления системы.

В данных тестах необходимо использовать моки репозиториев.

# Ссылки

https://www.nuget.org/packages/NSubstitute

### Для ознакомления с библиотекой MSDI

https://learn.microsoft.com/en-us/dotnet/core/extensions/dependency-injection-usage (очень плохие практики в примерах
кода, использовать только как шоукейс технологии)